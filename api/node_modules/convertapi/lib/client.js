'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _axios=require('axios'),_axios2=_interopRequireDefault(_axios),_fs=require('fs'),_fs2=_interopRequireDefault(_fs),_utils=require('./utils'),_upload_result=require('./upload_result'),_upload_result2=_interopRequireDefault(_upload_result),_error=require('./error'),_error2=_interopRequireDefault(_error);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}class Client{constructor(a){this.api=a,this.defaultHeader={"User-Agent":a.userAgent,"Content-Type":'application/x-www-form-urlencoded',Accept:'application/json'}}get(a,b={},c=null){return(0,_axios2.default)({method:'get',url:this.url(a),headers:this.defaultHeader,params:b,timeout:1e3*c}).then(a=>a.data).catch(a=>{throw new _error2.default(a,a.response.data)})}post(a,b,c=null){return(0,_axios2.default)({method:'post',url:this.url(a),headers:this.defaultHeader,data:(0,_utils.buildQueryString)(b),timeout:1e3*c}).then(a=>a.data).catch(a=>{throw new _error2.default(a,a.response.data)})}download(a,b){var c=this;return _asyncToGenerator(function*(){const d=yield(0,_axios2.default)({url:a,timeout:1e3*c.api.downloadTimeout,responseType:'stream'}).catch(function(a){throw new _error2.default(a)});return d.data.pipe(_fs2.default.createWriteStream(b)),new Promise(function(a,c){d.data.on('end',function(){a(b)}),d.data.on('error',function(a){c(new _error2.default(a))})})})()}upload(a,b){const c=encodeURIComponent(b),d=Object.assign({"Content-Type":'application/octet-stream',"Content-Disposition":`attachment; filename*=UTF-8''${c}`},this.defaultHeader);return(0,_axios2.default)({method:'post',url:this.url('upload'),headers:d,data:a,timeout:1e3*this.api.uploadTimeout}).then(a=>new _upload_result2.default(a.data)).catch(a=>{throw new _error2.default(a)})}url(a){return`${this.api.baseUri}${a}?secret=${this.api.secret}`}}exports.default=Client,module.exports=exports['default'];